<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Detect outliers — find_outliers • joeyr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Detect outliers — find_outliers"><meta name="description" content="This is an implementation of the Mahalanobis Distance that is less sensitive
to outliers, first implemented in Stanley (2020). Instead of a blanket filter
applying all at once, it iteratively removes points one at a time until a
predetermined proportion of data has been removed."><meta property="og:description" content="This is an implementation of the Mahalanobis Distance that is less sensitive
to outliers, first implemented in Stanley (2020). Instead of a blanket filter
applying all at once, it iteratively removes points one at a time until a
predetermined proportion of data has been removed."><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@joey_stan"><meta name="twitter:site" content="@joey_stan"><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-86802921-3"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-86802921-3');
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">joeyr</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.11</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/JoeyStanley/joeyr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Detect outliers</h1>
      <small class="dont-index">Source: <a href="https://github.com/JoeyStanley/joeyr/blob/master/R/outliers.R" class="external-link"><code>R/outliers.R</code></a></small>
      <div class="d-none name"><code>find_outliers.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This is an implementation of the Mahalanobis Distance that is less sensitive
to outliers, first implemented in Stanley (2020). Instead of a blanket filter
applying all at once, it iteratively removes points one at a time until a
predetermined proportion of data has been removed.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">find_outliers</span><span class="op">(</span><span class="va">...</span>, keep <span class="op">=</span> <span class="fl">0.95</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>A list of columns in your data that should be included when
calculating the Mahalanobis distance. The column names should not be in
quotes. For vowel data, you typically include F1 and F2. You may also
want to include F3, duration, and any other continuous variable.</p></dd>


<dt id="arg-keep">keep<a class="anchor" aria-label="anchor" href="#arg-keep"></a></dt>
<dd><p>A number indicating the proportion of data (per group) to keep.
By default, it's 0.95 so it keeps 95% of the data and filters out 5%.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>logical, <code>FALSE</code> by default. If <code>TRUE</code>, you'll get
a message for every group with less than 20 tokens saying that there
weren't enough tokens to remove outliers. Can be quite verbose if there are
many speakers/vowels.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A vector of TRUE/FALSE values. They are in the same order as the original
  dataset. Observations that are considered outliers have the value TRUE. It is
  easiest to work with this by appending this vector to your dataframe.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The Mahalanobis distance function is somewhat sensitive to outliers, so if
there are extreme values in your data, the mean value will be off-center from
the centroid of your observations. Consequently, the Mahalanobis Distances
will be based on this off-center points, which is probably not desirable.
This function alleviates this sensitivity to outliers by implementing a
one-at-a-time method.</p>
<p>When you run this function, it will first calculate Mahalanobis distance from
the mean of all values. It detects the point furthest from the mean and
removes it. Then, it recalculates the Mahalanobis distance with the remaining
values and again removes the furthest value. It continues this
recalculation-and-removal method until a predetermined proportion of values
has been removed.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>While not required, you should typically "group" your data before applying
  this function. For example, you can group your data by speaker and vowel so
  that the function applies independently for each vowel for each speaker. I
  normally do this with <code>dplyr::group_by(speaker, word)</code></p>
<p>Note also that in American English, allophonic variation of some vowels is so
  great that grouping by vowel may not be enough. If you're working with /u/ for
  example, it's a good idea to split it into three groups: post-coronal, pre-lateral,
  and elsewhere. For /æ/, it's a good idea to group prenasal tokens separately.
  If you're using FAVE/DARLA/MFA output, the NORTH and FORCE classes of words
  are transcribed with AO, so it's a good idea to treat those separately. The point
  is to be mindful of allophonic variation in your data and that it's a good
  idea to group the data by vowel <em>class</em> rather than by vowel. You may have to
  do some processing before the filter happens to get this to happen. As of
  version 0.8 of joeyr, you can now use the <code>code_allophones</code> function
  to automatically classify your data into allophones.</p>
<p>Finally, be aware that no tokens will be marked as outliers if the are not
  a sufficient number of tokens. So if you want to remove 5<!-- % of the tokens, -->
  you'll need to have at least 20 tokens in a group for an outlier to be
  found within that group. A message will let you know if this happens.
  Unfortunately, the function cannot help determine which group(s) the
  message came from, but you can find out with <code><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">dplyr::count()</a></code>. See the
  examples.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>If you use this function, you can refer to it as something like "the Modified
Mahalanobis Distance method implemented in Stanley (2020)."</p>
<p>Stanley, Joseph A. "The Absence of a Religiolect among Latter-Day Saints in
Southwest Washington." In <em>Speech in the Western States: Volume 3,
Understudied Varieties</em>, by Valerie Fridland, Alicia Beckford Wassink, Lauren
Hall-Lew, and Tyler Kendall, 95–122. Publication of the American Dialect
Society 105. Durham, NC: Duke University Press, 2020.
<a href="https://doi.org/10.1215/00031283-8820642" class="external-link">https://doi.org/10.1215/00031283-8820642</a>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">joeysvowels</span><span class="fu">::</span><span class="va">coronals</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in loadNamespace(x):</span> there is no package called ‘joeysvowels’</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># You can output the data to a column called something like "is_outlier" and</span></span></span>
<span class="r-in"><span><span class="co"># then filter out values that are TRUE.</span></span></span>
<span class="r-in"><span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">vowel</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>is_outlier <span class="op">=</span> <span class="fu">find_outliers</span><span class="op">(</span><span class="va">F1</span>, <span class="va">F2</span>, keep <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">is_outlier</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in UseMethod("group_by"):</span> no applicable method for 'group_by' applied to an object of class "function"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Alternatively, you can skip a step and just keep the data that are not</span></span></span>
<span class="r-in"><span><span class="co"># outliers.</span></span></span>
<span class="r-in"><span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">vowel</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu">find_outliers</span><span class="op">(</span><span class="va">F1</span>, <span class="va">F2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in UseMethod("group_by"):</span> no applicable method for 'group_by' applied to an object of class "function"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># In some cases, you might not have enough data. In this case, a warning</span></span></span>
<span class="r-in"><span><span class="co"># message will appear.</span></span></span>
<span class="r-in"><span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">percent</span> <span class="op">==</span> <span class="fl">50</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">vowel</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>is_outlier <span class="op">=</span> <span class="fu">find_outliers</span><span class="op">(</span><span class="va">F1</span>, <span class="va">F2</span>, keep <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in UseMethod("filter"):</span> no applicable method for 'filter' applied to an object of class "function"</span>
<span class="r-in"><span><span class="co"># You can find out which groups have less than 20 tokens with `dplyr::count()`:</span></span></span>
<span class="r-in"><span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">percent</span> <span class="op">==</span> <span class="fl">50</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">vowel</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in UseMethod("filter"):</span> no applicable method for 'filter' applied to an object of class "function"</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Joseph A. Stanley.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

