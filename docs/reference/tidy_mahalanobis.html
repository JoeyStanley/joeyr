<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Calculate Mahalanobis Distance — tidy_mahalanobis • joeyr</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Calculate Mahalanobis Distance — tidy_mahalanobis" />
<meta property="og:description" content="This is a tidyverse-tidyverse-compatible version of the stats::mahalanobis function. It just 
makes it easier to include it as part of a dplyr::mutate." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-86802921-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-86802921-2');
</script>


  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">joeyr</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.6.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/JoeyStanley/joeyr/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculate Mahalanobis Distance</h1>
    <small class="dont-index">Source: <a href='https://github.com/JoeyStanley/joeyr/blob/master/R/sociophonetics.R'><code>R/sociophonetics.R</code></a></small>
    <div class="hidden name"><code>tidy_mahalanobis.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This is a tidyverse-tidyverse-compatible version of the <code><a href='https://rdrr.io/r/stats/mahalanobis.html'>stats::mahalanobis</a></code> function. It just 
makes it easier to include it as part of a <code><a href='https://dplyr.tidyverse.org/reference/mutate.html'>dplyr::mutate</a></code>.</p>
    </div>

    <pre class="usage"><span class='fu'>tidy_mahalanobis</span>(<span class='no'>...</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>...</th>
      <td><p>Names of columns that should be included in the Mahalanobis distance. For vowel data, this is typically your F1 and F2 columns.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A vector that contains the Mahalanobis distances for each observation.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Typically you'll want to group your data (using <code><a href='https://dplyr.tidyverse.org/reference/group_by.html'>dplyr::group_by</a></code>) by speaker and vowel 
class so that you get the distance from vowel centroids.</p>
<p>I won't tell you what to do with those distances, but if you might consider looking at tokens
where the square root of the Mahalanobis distance is greater than around 2. However, to be clear, 
the exact cutoff will vary depending on the size and variability of your data. You can see how 
you might isolate these points visually in the example code below.</p>
<p>One small modification that this function does that <code><a href='https://rdrr.io/r/stats/mahalanobis.html'>stats::mahalanobis</a></code> does not do is that 
if there are fewer than 5 measurements in a group, <code>tidy_mahalanobis</code> returns them all 
as having a distance of zero. I found that this prevents some fatal errors from crashing the script
when running this function on smaller datasets.</p>
<p>Note that this function requires the <code>MASS</code> package to be installed to work, but you 
don't need to load it.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/message.html'>suppressPackageStartupMessages</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>tidyverse</span>))
<span class='no'>df</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>joeysvowels</span><span class='kw ns'>::</span><span class='no'><a href='https://rdrr.io/pkg/joeysvowels/man/midpoints.html'>midpoints</a></span>

<span class='co'># Calculate the distances</span>
<span class='no'>m_dists</span> <span class='kw'>&lt;-</span> <span class='no'>df</span> <span class='kw'>%&gt;%</span>
  <span class='fu'>group_by</span>(<span class='no'>vowel</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'>mutate</span>(<span class='kw'>mahal_dist</span> <span class='kw'>=</span> <span class='fu'>tidy_mahalanobis</span>(<span class='no'>F1</span>, <span class='no'>F2</span>))

<span class='co'># Take a peek at the resulting dataset</span>
<span class='no'>m_dists</span> <span class='kw'>%&gt;%</span>
  <span class='fu'>select</span>(<span class='no'>vowel</span>, <span class='no'>F1</span>, <span class='no'>F2</span>, <span class='no'>mahal_dist</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>()</div><div class='output co'>#&gt; <span style='color: #555555;'># A tibble: 6 x 4</span><span>
#&gt; </span><span style='color: #555555;'># Groups:   vowel [4]</span><span>
#&gt;   vowel    F1    F2 mahal_dist
#&gt;   </span><span style='color: #555555;font-style: italic;'>&lt;fct&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>      </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
#&gt; </span><span style='color: #555555;'>1</span><span> GOAT   368. </span><span style='text-decoration: underline;'>1</span><span>018.      5.66 
#&gt; </span><span style='color: #555555;'>2</span><span> FACE   377. </span><span style='text-decoration: underline;'>2</span><span>032.      6.52 
#&gt; </span><span style='color: #555555;'>3</span><span> FACE   314. </span><span style='text-decoration: underline;'>2</span><span>179.      2.16 
#&gt; </span><span style='color: #555555;'>4</span><span> GOOSE  274. </span><span style='text-decoration: underline;'>1</span><span>378.      0.755
#&gt; </span><span style='color: #555555;'>5</span><span> FOOT   350. </span><span style='text-decoration: underline;'>1</span><span>624.      4.95 
#&gt; </span><span style='color: #555555;'>6</span><span> FACE   313. </span><span style='text-decoration: underline;'>2</span><span>181.      2.28 </div><div class='input'>
<span class='co'># Plot potential outliers</span>
<span class='fu'>ggplot</span>(<span class='no'>m_dists</span>, <span class='fu'>aes</span>(<span class='no'>F2</span>, <span class='no'>F1</span>, <span class='kw'>color</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>(<span class='no'>mahal_dist</span>) <span class='kw'>&gt;</span> <span class='fl'>2</span>)) +
   <span class='fu'>geom_point</span>() +
   <span class='fu'>scale_x_reverse</span>() +
   <span class='fu'>scale_y_reverse</span>()</div><div class='img'><img src='tidy_mahalanobis-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># You can include whatever numeric variables you want, like duration</span>
<span class='no'>df</span> <span class='kw'>%&gt;%</span>
  <span class='fu'>group_by</span>(<span class='no'>vowel</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'>mutate</span>(<span class='kw'>dur</span> <span class='kw'>=</span> <span class='no'>end</span> - <span class='no'>start</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'>mutate</span>(<span class='kw'>mahal_dist</span> <span class='kw'>=</span> <span class='fu'>tidy_mahalanobis</span>(<span class='no'>F1</span>, <span class='no'>F2</span>, <span class='no'>dur</span>)) <span class='kw'>%&gt;%</span>
  <span class='fu'>ggplot</span>(<span class='fu'>aes</span>(<span class='no'>F2</span>, <span class='no'>F1</span>, <span class='kw'>color</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>(<span class='no'>mahal_dist</span>) <span class='kw'>&gt;</span> <span class='fl'>2.5</span>)) +
  <span class='fu'>geom_point</span>() +
  <span class='fu'>scale_x_reverse</span>() +
  <span class='fu'>scale_y_reverse</span>()</div><div class='img'><img src='tidy_mahalanobis-2.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># Data cannot contain NAs. Remove them before running.</span>
<span class='no'>df</span>[<span class='fl'>1</span>,]$<span class='no'>F1</span> <span class='kw'>&lt;-</span> <span class='fl'>NA</span>
<span class='no'>df</span> <span class='kw'>%&gt;%</span>
  <span class='fu'>group_by</span>(<span class='no'>vowel</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'>mutate</span>(<span class='kw'>mahal_dist</span> <span class='kw'>=</span> <span class='fu'>tidy_mahalanobis</span>(<span class='no'>F1</span>, <span class='no'>F2</span>))</div><div class='output co'>#&gt; <span class='error'>Error: Problem with `mutate()` input `mahal_dist`.</span>
#&gt; <span class='error'></span><span style='color: #BB0000;'>x</span><span> Your data has some NAs, which will cause `tidy_mahalnobis` to crash. Try removing NAs before running `tidy_mahalanobis`.</span>
#&gt; <span class='error'></span><span style='color: #0000BB;'>ℹ</span><span> Input `mahal_dist` is `tidy_mahalanobis(F1, F2)`.</span>
#&gt; <span class='error'></span><span style='color: #0000BB;'>ℹ</span><span> The error occurred in group 7: vowel = "GOAT".</span></div><div class='input'><span class='no'>df</span> <span class='kw'>%&gt;%</span>
  <span class='fu'>group_by</span>(<span class='no'>vowel</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span>(!<span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span>(<span class='no'>F1</span>)) <span class='kw'>%&gt;%</span>
  <span class='fu'>mutate</span>(<span class='kw'>mahal_dist</span> <span class='kw'>=</span> <span class='fu'>tidy_mahalanobis</span>(<span class='no'>F1</span>, <span class='no'>F2</span>)) <span class='kw'>%&gt;%</span>
  <span class='fu'>select</span>(<span class='no'>vowel_id</span>, <span class='no'>vowel</span>, <span class='no'>mahal_dist</span>, <span class='no'>F1</span>, <span class='no'>F2</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>()</div><div class='output co'>#&gt; </span><span style='color: #555555;'># A tibble: 6 x 5</span><span>
#&gt; </span><span style='color: #555555;'># Groups:   vowel [3]</span><span>
#&gt;   vowel_id vowel mahal_dist    F1    F2
#&gt;      </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;fct&gt;</span><span>      </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
#&gt; </span><span style='color: #555555;'>1</span><span>        2 FACE       6.52   377. </span><span style='text-decoration: underline;'>2</span><span>032.
#&gt; </span><span style='color: #555555;'>2</span><span>        4 FACE       2.16   314. </span><span style='text-decoration: underline;'>2</span><span>179.
#&gt; </span><span style='color: #555555;'>3</span><span>        5 GOOSE      0.755  274. </span><span style='text-decoration: underline;'>1</span><span>378.
#&gt; </span><span style='color: #555555;'>4</span><span>        7 FOOT       4.95   350. </span><span style='text-decoration: underline;'>1</span><span>624.
#&gt; </span><span style='color: #555555;'>5</span><span>        8 FACE       2.28   313. </span><span style='text-decoration: underline;'>2</span><span>181.
#&gt; </span><span style='color: #555555;'>6</span><span>        9 GOOSE      1.63   255. </span><span style='text-decoration: underline;'>1</span><span>333.</div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Joseph A. Stanley.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


